--[[
    LitClient FE | v1.0.3 (Compact / Mobile Friendly)
    Style: Infinite Yield (Sleek, Bottom Right, Locked Position)
]]

local Players = game:GetService("Players")
local TweenService = game:GetService("TweenService")
local UserInputService = game:GetService("UserInputService")
local CoreGui = game:GetService("CoreGui")
local LocalPlayer = Players.LocalPlayer

--// CONFIG
local Config = {
    Color = Color3.fromRGB(50, 50, 50), -- Dark Grey (IY Style)
    Accent = Color3.fromRGB(255, 255, 255), -- White Text
    Prefix = ";",
    Speed = 0.3 -- Animation speed
}

-- ==============================
-- LitClient FE — PROPER FLY 2025 (Mobile + PC)
-- ==============================

local Flying = false
local FlySpeed = 100
local BodyGyro = nil
local BodyVelocity = nil
local JumpBoostActive = 0

local function StartFly(speed)
    if Flying then return end
    Flying = true
    FlySpeed = tonumber(speed) or 100

    local char = LocalPlayer.Character or LocalPlayer.CharacterAdded:Wait()
    local hrp = char:WaitForChild("HumanoidRootPart")
    local hum = char:WaitForChild("Humanoid")

    hum.PlatformStand = true

    -- BodyGyro (keeps you facing camera direction)
    BodyGyro = Instance.new("BodyGyro")
    BodyGyro.P = 15000
    BodyGyro.MaxTorque = Vector3.new(400000, 400000, 400000)
    BodyGyro.CFrame = hrp.CFrame
    BodyGyro.Parent = hrp

    -- BodyVelocity (actual movement)
    BodyVelocity = Instance.new("BodyVelocity")
    BodyVelocity.Velocity = Vector3.new(0, 0, 0)
    BodyVelocity.MaxForce = Vector3.new(400000, 400000, 400000)
    BodyVelocity.Parent = hrp

    -- Jump boost on mobile/PC spacebar
    local jumpConn
    jumpConn = UserInputService.JumpRequest:Connect(function()
        if Flying then
            JumpBoostActive = 40 -- instant upward kick
        end
    end)

    -- Main fly loop
    local connection
    connection = RunService.RenderStepped:Connect(function(dt)
        if not (char and char:FindFirstChild("HumanoidRootPart") and Flying) then
            StopFly()
            return
        end

        local cam = workspace.CurrentCamera
        local moveDir = hum.MoveDirection * FlySpeed
        local camLook = cam.CFrame.LookVector

        -- Forward movement aligned with camera
        local forward = Vector3.new(camLook.X, 0, camLook.Z).Unit * moveDir.Magnitude
        if moveDir.Magnitude > 0 then
            forward = moveDir.Unit
        end

        -- Vertical from camera pitch + jump boost
        local up = 0
        if UserInputService.TouchEnabled then
            -- Mobile: stronger upward when looking up
            up = camLook.Y * 80
        else
            up = camLook.Y * 60
        end

        -- Jump boost decay
        if JumpBoostActive > 0 then
            up = up + JumpBoostActive
            JumpBoostActive = math.max(0, JumpBoostActive - 120 * dt)
        end

        -- Final velocity
        local velocity = (forward * FlySpeed) + Vector3.new(0, up, 0)

        BodyVelocity.Velocity = velocity
        BodyGyro.CFrame = CFrame.new(Vector3.new(), camLook)
    end)

    -- Auto-cleanup on death
    local diedConn
    diedConn = hum.Died:Connect(function()
        StopFly()
    end)

    -- Store connections for cleanup
    StartFly._conn = connection
    StartFly._jumpConn = jumpConn
    StartFly._diedConn = diedConn

    -- Notification
    game:GetService("StarterGui"):SetCore("SendNotification", {
        Title = "LitClient";
        Text = "Fly ON — Speed: " .. FlySpeed;
        Duration = 2;
    })
end

function StopFly()
    if not Flying then return end
    Flying = false

    if BodyGyro then BodyGyro:Destroy() BodyGyro = nil end
    if BodyVelocity then BodyVelocity:Destroy() BodyVelocity = nil end

    if StartFly._conn then StartFly._conn:Disconnect() StartFly._conn = nil end
    if StartFly._jumpConn then StartFly._jumpConn:Disconnect() StartFly._jumpConn = nil end
    if StartFly._diedConn then StartFly._diedConn:Disconnect() StartFly._diedConn = nil end

    local char = LocalPlayer.Character
    if char and char:FindFirstChild("Humanoid") then
        char.Humanoid.PlatformStand = false
    end

    game:GetService("StarterGui"):SetCore("SendNotification", {
        Title = "LitClient";
        Text = "Fly OFF";
        Duration = 1.5;
    })
end

-- Fix your command table (you had "Flying" instead of "FlyActive" or whatever)
for _, cmd in pairs(Commands) do
    if cmd.Name == "fly" then
        cmd.Func = function(args)
            if Flying then StopFly() else StartFly(args[1]) end
        end
    end
end

--// COMMAND TABLE (Edit Here)
local Commands = {
    {
        Name = "fly", 
        Desc = "Toggle flight mode, optional speed (e.g., ;fly 150)", 
        Func = function(args) 
            if Flying then 
                StopFly() 
            else 
                StartFly(args[1]) 
            end 
        end
    },
    {
        Name = "unfly",
        Desc = "Stops flight mode immediately",
        Func = StopFly
    },
    {
        Name = "speed", 
        Desc = "Set walkspeed (e.g. ;speed 100)", 
        Func = function(args)
            if LocalPlayer.Character and args[1] then
                LocalPlayer.Character:FindFirstChildWhichIsA("Humanoid").WalkSpeed = tonumber(args[1]) or 16
            end
        end
    },
    {
        Name = "jump", 
        Desc = "Set jumppower (e.g. ;jump 100)", 
        Func = function(args)
            if LocalPlayer.Character and args[1] then
                LocalPlayer.Character:FindFirstChildWhichIsA("Humanoid").JumpPower = tonumber(args[1]) or 50
            end
        end
    },
    {
        Name = "esp",
        Desc = "Highlight all players",
        Func = function()
            for _, p in pairs(Players:GetPlayers()) do
                if p ~= LocalPlayer and p.Character then
                    if not p.Character:FindFirstChild("Highlight") then
                        local h = Instance.new("Highlight", p.Character)
                        h.FillColor = Color3.fromRGB(255, 0, 0)
                        h.OutlineColor = Color3.fromRGB(255, 255, 255)
                        h.FillTransparency = 0.5
                    end
                end
            end
        end
    },
    {
        Name = "rejoin",
        Desc = "Rejoins the server",
        Func = function()
            game:GetService("TeleportService"):Teleport(game.PlaceId, LocalPlayer)
        end
    }
}

--// UI CONSTRUCTION
local LitGUI = Instance.new("ScreenGui")
LitGUI.Name = "LitClientFE"
LitGUI.Parent = CoreGui
LitGUI.ResetOnSpawn = false

-- 1. Main Bar (Bottom Right)
local MainBar = Instance.new("Frame")
MainBar.Name = "MainBar"
MainBar.Parent = LitGUI
MainBar.BackgroundColor3 = Config.Color
MainBar.BackgroundTransparency = 0.1
MainBar.Position = UDim2.new(1, -260, 1, -50) -- Locked Bottom Right Corner
MainBar.Size = UDim2.new(0, 250, 0, 35)
MainBar.BorderSizePixel = 0
MainBar.Active = true
MainBar.Draggable = false -- HARDCODED: No longer draggable!

local Corner = Instance.new("UICorner")
Corner.CornerRadius = UDim.new(0, 6)
Corner.Parent = MainBar

-- Input Box
local Input = Instance.new("TextBox")
Input.Parent = MainBar
Input.BackgroundTransparency = 1
Input.Position = UDim2.new(0, 10, 0, 0)
Input.Size = UDim2.new(1, -40, 1, 0)
Input.Font = Enum.Font.GothamBold
Input.PlaceholderText = "Command Bar (;)"
Input.Text = ""
Input.TextColor3 = Config.Accent
Input.PlaceholderColor3 = Color3.fromRGB(150, 150, 150)
Input.TextSize = 14
Input.TextXAlignment = Enum.TextXAlignment.Left

-- Toggle Button (For the list)
local ListToggle = Instance.new("TextButton")
ListToggle.Parent = MainBar
ListToggle.BackgroundTransparency = 1
ListToggle.Position = UDim2.new(1, -30, 0, 0)
ListToggle.Size = UDim2.new(0, 30, 1, 0)
ListToggle.Font = Enum.Font.GothamBold
ListToggle.Text = "+"
ListToggle.TextColor3 = Config.Accent
ListToggle.TextSize = 18

-- 2. Command List (Hidden by default, pops up above bar)
local ListFrame = Instance.new("Frame")
ListFrame.Name = "ListFrame"
ListFrame.Parent = MainBar
ListFrame.BackgroundColor3 = Config.Color
ListFrame.BackgroundTransparency = 0.1
ListFrame.Position = UDim2.new(0, 0, 0, 0) -- Starts closed
ListFrame.Size = UDim2.new(1, 0, 0, 0) -- Height 0
ListFrame.ClipsDescendants = true
ListFrame.BorderSizePixel = 0
ListFrame.ZIndex = 0

local ListCorner = Instance.new("UICorner")
ListCorner.CornerRadius = UDim.new(0, 6)
ListCorner.Parent = ListFrame

local Scroller = Instance.new("ScrollingFrame")
Scroller.Parent = ListFrame
Scroller.BackgroundTransparency = 1
Scroller.Position = UDim2.new(0, 5, 0, 5)
Scroller.Size = UDim2.new(1, -10, 1, -10)
Scroller.CanvasSize = UDim2.new(0, 0, 0, 0)
Scroller.ScrollBarThickness = 2

local UIList = Instance.new("UIListLayout")
UIList.Parent = Scroller
UIList.SortOrder = Enum.SortOrder.LayoutOrder

--// FUNCTIONS
local ListOpen = false

local function ToggleList()
    ListOpen = not ListOpen
    local targetSize = ListOpen and UDim2.new(1, 0, 0, 200) or UDim2.new(1, 0, 0, 0)
    local targetPos = ListOpen and UDim2.new(0, 0, 1, -240) or UDim2.new(0, 0, 0, 0) -- Slide UP
    
    ListToggle.Text = ListOpen and " ^" or "+" -- Update button text for clarity

    TweenService:Create(ListFrame, TweenInfo.new(Config.Speed, Enum.EasingStyle.Quart), {
        Size = targetSize,
        Position = targetPos
    }):Play()
end

local function PopulateList()
    -- Clear old
    for _, v in pairs(Scroller:GetChildren()) do
        if v:IsA("TextLabel") then v:Destroy() end
    end
    
    local ySize = 0
    for i, cmd in pairs(Commands) do
        local lbl = Instance.new("TextLabel")
        lbl.Parent = Scroller
        lbl.BackgroundTransparency = 1
        lbl.Size = UDim2.new(1, 0, 0, 25)
        lbl.Font = Enum.Font.Gotham
        lbl.TextColor3 = Config.Accent
        lbl.TextXAlignment = Enum.TextXAlignment.Left
        lbl.Text = Config.Prefix .. cmd.Name .. " - " .. cmd.Desc
        lbl.TextSize = 12
        ySize = ySize + 25
    end
    Scroller.CanvasSize = UDim2.new(0, 0, 0, ySize)
end

local function Execute(text)
    local args = text:split(" ")
    local cmdName = table.remove(args, 1):lower()
    
    if string.sub(cmdName, 1, 1) == Config.Prefix then
        cmdName = string.sub(cmdName, 2)
    end

    local found = false
    for _, cmd in pairs(Commands) do
        if cmd.Name:lower() == cmdName then
            cmd.Func(args)
            found = true
            -- Visual Feedback
            Input.PlaceholderText = "Executed: " .. cmdName
            wait(1)
            Input.PlaceholderText = "Command Bar (;) • LitClient FE (v1.0.3)"
            break
        end
    end
    
    if not found then
        Input.PlaceholderText = "Invalid Command"
        wait(1)
        Input.PlaceholderText = "Command Bar"
    end
end

--// EVENTS
ListToggle.MouseButton1Click:Connect(ToggleList)

Input.FocusLost:Connect(function(enter)
    if enter and Input.Text ~= "" then
        Execute(Input.Text)
        Input.Text = ""
    end
end)

-- Initialize List
PopulateList()

game:GetService("StarterGui"):SetCore("SendNotification", {
    Title = "LitClient FE";
    Text = "Loaded!";
    Duration = 0.7;
})
