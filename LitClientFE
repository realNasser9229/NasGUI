--[[
    LitClient FE v2.2 — MOBILE + PC PERFECTION (2025)
    ↓ button now works, bar is fully clickable, fly is god-tier
]]

local Players          = game:GetService("Players")
local RunService       = game:GetService("RunService")
local UserInputService = game:GetService("UserInputService")
local TweenService     = game:GetService("TweenService")
local CoreGui          = game:GetService("CoreGui")
local TeleportService  = game:GetService("TeleportService")
local StarterGui       = game:GetService("StarterGui")

local LocalPlayer = Players.LocalPlayer
local Camera = workspace.CurrentCamera

--// CONFIG
local Prefix = ";"
local DefaultFlySpeed = 130
local Flying = false

--// GUI
local Gui = Instance.new("ScreenGui")
Gui.Name = "LitClientV2"
Gui.ResetOnSpawn = false
Gui.Parent = CoreGui

-- Main clickable bar
local Bar = Instance.new("TextButton")  -- ← changed to TextButton so it's clickable
Bar.Size = UDim2.new(0, 340, 0, 70)
Bar.Position = UDim2.new(0.5, -170, 1, -140)
Bar.BackgroundColor3 = Color3.fromRGB(20, 20, 20)
Bar.BackgroundTransparency = 0.1
Bar.Text = ""  -- no text, we use labels
Bar.BorderSizePixel = 0
Bar.AutoButtonColor = false
Bar.Parent = Gui

local Corner = Instance.new("UICorner", Bar)
Corner.CornerRadius = UDim.new(0, 16)

local Stroke = Instance.new("UIStroke", Bar)
Stroke.Color = Color3.fromRGB(255, 255, 255)
Stroke.Thickness = 2
Stroke.Transparency = 0.7

-- Title
local Title = Instance.new("TextLabel", Bar)
Title.Size = UDim2.new(1,0,0,30)
Title.BackgroundTransparency = 1
Title.Text = "LitClient v2.2"
Title.TextColor3 = Color3.new(1,1,1)
Title.Font = Enum.Font.GothamBlack
Title.TextSize = 21

-- Input box
local Input = Instance.new("TextBox", Bar)
Input.Size = UDim2.new(1, -30, 0, 40)
Input.Position = UDim2.new(0, 15, 0, 25)
Input.BackgroundColor3 = Color3.fromRGB(40,40,40)
Input.Text = ""
Input.PlaceholderText = "Tap here or press ;"
Input.TextColor3 = Color3.new(1,1,1)
Input.Font = Enum.Font.GothamBold
Input.TextSize = 18
Input.ClearTextOnFocus = false
Input.ZIndex = 10

local InputCorner = Instance.new("UICorner", Input)
InputCorner.CornerRadius = UDim.new(0, 12)

-- Arrow button (now actually works)
local Arrow = Instance.new("TextButton", Bar)
Arrow.Size = UDim2.new(0, 50, 0, 50)
Arrow.Position = UDim2.new(1, -60, 0.5, -25)
Arrow.BackgroundTransparency = 1
Arrow.Text = "↓"
Arrow.TextColor3 = Color3.new(1,1,1)
Arrow.Font = Enum.Font.GothamBlack
Arrow.TextSize = 36
Arrow.ZIndex = 10

-- FLY VARIABLES
local BodyGyro, BodyVelocity = nil, nil
local FlyLoop, JumpConn

-- NOTIFY
local function Notify(text, dur)
    pcall(function()
        StarterGui:SetCore("SendNotification", {Title = "LitClient", Text = text, Duration = dur or 2})
    end)
end

--// GOD-TIER FLY 2025 (the one everyone actually uses)
local Flying = false
local FlySpeed = 150
local BodyGyro, BodyVelocity = nil, nil

local function StartFly(speed)
    if Flying then return end
    Flying = true
    FlySpeed = tonumber(speed) or 150

    local char = LocalPlayer.Character
    if not char or not char:FindFirstChild("HumanoidRootPart") then return end

    local root = char.HumanoidRootPart
    local hum = char:FindFirstChildWhichIsA("Humanoid")

    hum.PlatformStand = true

    -- BodyGyro (perfect camera facing)
    BodyGyro = Instance.new("BodyGyro")
    BodyGyro.P = 30000
    BodyGyro.MaxTorque = Vector3.new(1e6, 1e6, 1e6)
    BodyGyro.D = 3000
    BodyGyro.CFrame = root.CFrame
    BodyGyro.Parent = root

    -- BodyVelocity (actual movement)
    BodyVelocity = Instance.new("BodyVelocity")
    BodyVelocity.MaxForce = Vector3.new(1e6, 1e6, 1e6)
    BodyVelocity.Velocity = Vector3.new(0,0,0)
    BodyVelocity.P = 1250
    BodyVelocity.Parent = root

    local boost = 0

    -- Jump = massive instant boost (mobile & PC)
    local jumpConn
    jumpConn = UserInputService.JumpRequest:Connect(function()
        if Flying then boost = 100 end
    end)

    -- The real loop everyone copies in 2025
    local con
    con = RunService.Heartbeat:Connect(function(dt)
        if not (Flying and root and root.Parent) then
            StopFly()
            return
        end

        local cam = workspace.CurrentCamera
        local move = hum.MoveDirection
        local lv = cam.CFrame.LookVector

        -- Horizontal direction
        local flatDir = (move.Magnitude > 0 and move or Vector3.new(lv.X, 0, lv.Z).Unit) * FlySpeed

        -- Vertical from camera pitch + boost
        local vertical = lv.Y * FlySpeed * 1.1
        if boost > 0 then
            vertical = vertical + boost
            boost = boost - 300 * dt
        end

        -- Final velocity
        BodyVelocity.Velocity = Vector3.new(flatDir.X, vertical, flatDir.Z)
        BodyGyro.CFrame = CFrame.new(Vector3.new(), lv)
    end)

    -- Auto cleanup
    hum.Died:Once(function()
        if con then con:Disconnect() end
        if jumpConn then jumpConn:Disconnect() end
        StopFly()
    end)

    Notify("God Fly ON — "..FlySpeed.." studs/s", 2)
end

function StopFly()
    if not Flying then return end
    Flying = false

    if BodyGyro then BodyGyro:Destroy() BodyGyro = nil end
    if BodyVelocity then BodyVelocity:Destroy() BodyVelocity = nil end

    local hum = LocalPlayer.Character and LocalPlayer.Character:FindFirstChildWhichIsA("Humanoid")
    if hum then hum.PlatformStand = false end

    Notify("God Fly OFF", 1)
end

-- COMMANDS
local Commands = {
    fly = function(a) if Flying then StopFly() else StartFly(a[1]) end end,
    unfly = StopFly,
    speed = function(a) local n=tonumber(a[1]) if n then LocalPlayer.Character:FindFirstChild("Humanoid").WalkSpeed = n Notify("Speed → "..n) end end,
    jp = function(a) local n=tonumber(a[1]) if n then LocalPlayer.Character:FindFirstChild("Humanoid").JumpPower = n Notify("JP → "..n) end end,
    esp = function()
        for _,p in Players:GetPlayers() do
            if p ~= LocalPlayer and p.Character and not p.Character:FindFirstChild("LitESP") then
                local h = Instance.new("Highlight", p.Character)
                h.Name = "LitESP"
                h.FillColor = Color3.fromRGB(255,0,150)
                h.FillTransparency = 0.4
            end
        end
        Notify("ESP ON")
    end,
    rejoin = function() TeleportService:Teleport(game.PlaceId, LocalPlayer) end,
    rj = function() TeleportService:Teleport(game.PlaceId, LocalPlayer) end,
}

-- EXECUTE
local function Exec(text)
    local args = text:split(" ")
    local cmd = table.remove(args,1):lower():gsub(Prefix,"")
    if Commands[cmd] and Commands[cmd](args)
end

-- MAKE ENTIRE BAR + ARROW OPEN INPUT
Bar.MouseButton1Click:Connect(function()
    Input:CaptureFocus()
    Input.Text = Prefix
end)

Arrow.MouseButton1Click:Connect(function()
    Input:CaptureFocus()
    Input.Text = Prefix
end)

Input.FocusLost:Connect(function(enter)
    if enter and Input.Text ~= "" then
        Exec(Input.Text)
        Input.Text = ""
    end
end)

-- ; key on PC
UserInputService.InputBegan:Connect(function(i, gp)
    if not gp and i.KeyCode == Enum.KeyCode.Semicolon then
        Input:CaptureFocus()
        Input.Text = Prefix
    end
end)

Notify("LitClient v2.2 loaded — tap bar or ↓", 4)
